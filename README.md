# MAI Telegram Bot: Автоматизация обработки лекций

## Описание проекта

Этот Telegram-бот предназначен для автоматизации процесса обработки аудиозаписей лекций. Цель — сэкономить время преподавателей и предоставить студентам удобные материалы для обучения. Бот принимает аудиофайл лекции, обрабатывает его с помощью облачных сервисов Google Cloud и возвращает пользователю результаты обработки (в будущем — транскрипт, конспект, документы).

## Текущий статус (на Апрель 2025)

* **Реализовано:**
    * Прием метаданных лекции (дисциплина, преподаватель, дата/время) через диалог в Telegram.
    * Прием аудиофайла от пользователя.
    * Временное сохранение аудиофайла на сервере.
    * Загрузка аудиофайла в Google Cloud Storage (GCS) с использованием структурированного имени файла.
    * Базовая структура проекта (модульность).
    * Настройка логирования (в файл `logs/bot.log` и консоль).
    * Внешняя конфигурация через файл `.env`.
    * Заглушка для вызова Google Cloud Speech-to-Text API.
* **Следующие шаги / В планах:**
    * Полная реализация функции транскрибации аудио через Google Cloud Speech-to-Text (`app/audio_processor.py`).
    * Реализация модуля анализа текста (`app/text_analyzer.py`) для создания конспекта и выявления ключевых моментов.
    * Реализация модуля генерации документов (`app/doc_generator.py`) в форматах DOCX, PDF и др.
    * Отправка сгенерированных документов пользователю через Telegram.
    * Написание тестов (`tests/`).
    * Улучшение обработки ошибок и пользовательского опыта.
    * (Возможно) Интеграция с базой данных для хранения информации о лекциях и статусах обработки.

## Технологический стек

* **Язык:** Python 3.x
* **Telegram Bot:** `pyTelegramBotAPI`
* **Облачные сервисы:** Google Cloud Platform (GCP)
    * Google Cloud Storage (GCS) - для хранения аудиофайлов.
    * Google Cloud Speech-to-Text (S2T) - для транскрибации аудио.
* **Конфигурация:** `python-dotenv` (для `.env` файла)
* **(Планируется):** `python-docx` (для генерации .docx), библиотеки для NLP/анализа, возможно, для конвертации в PDF.

## Структура проекта

```
MAI_bot/
│
├── .venv/                  # Виртуальное окружение Python
│
├── app/                    # Основная логика приложения
│   ├── __init__.py         # Инициализация пакета app
│   ├── audio_processor.py  # Обработка аудио (транскрибация S2T)
│   ├── cloud_storage.py    # Взаимодействие с Google Cloud Storage (GCS)
│   ├── doc_generator.py    # Генерация итоговых документов (DOCX, PDF, etc.) - В разработке
│   ├── telegram_handler.py # Обработка сообщений и команд Telegram, управление диалогом
│   ├── text_analyzer.py    # Анализ текста транскрипта (NLP) - В разработке
│   └── utils.py            # Вспомогательные функции (логирование, генерация имен файлов)
│
├── temp/                   # Временное хранение файлов (при загрузке/обработке)
│
├── logs/                   # Файлы логов работы бота
│
├── tests/                  # Автоматические тесты - В разработке
│   ├── __init__.py
│   # ... файлы тестов ...
│
├── .env                    # Файл для хранения секретов (API ключи, токены) - НЕ КОММИТИТЬ В GIT!
├── .gitignore              # Файл для исключения ненужных файлов из Git
├── config.py               # Загрузка конфигурации из .env и определение констант
├── main.py                 # Точка входа в приложение, инициализация и запуск бота
├── README.md               # Этот файл - описание проекта
└── requirements.txt        # Список зависимостей Python
```

## Схема работы (Workflow)

1.  **Инициация (`/start`):** Пользователь запускает бота командой `/start`.
    * Модуль: `app/telegram_handler.py`
2.  **Сбор метаданных:** Бот последовательно запрашивает у пользователя название дисциплины, ФИО преподавателя, дату и время начала лекции. Ответы сохраняются во временном состоянии пользователя.
    * Модуль: `app/telegram_handler.py`
3.  **Прием аудио:** Бот просит отправить аудиофайл лекции.
    * Модуль: `app/telegram_handler.py`
4.  **Загрузка и сохранение:** Получив аудио, `telegram_handler` скачивает его во временный файл в папку `temp/`.
    * Модули: `app/telegram_handler.py`, `app/utils.py` (генерация имени)
5.  **Загрузка в GCS:** Временный файл загружается в бакет Google Cloud Storage. Имя файла в GCS формируется на основе метаданных. Временный файл на сервере удаляется.
    * Модули: `app/telegram_handler.py` -> `app/cloud_storage.py`
6.  **Транскрибация (WIP):** Бот передает URI файла в GCS сервису Google Cloud Speech-to-Text для асинхронной обработки.
    * Модули: `app/telegram_handler.py` -> `app/audio_processor.py`
7.  **Получение транскрипта (WIP):** Бот ожидает и получает готовый текст лекции.
    * Модуль: `app/audio_processor.py` -> `app/telegram_handler.py`
8.  **Анализ текста (TODO):** Полученный транскрипт анализируется для выделения ключевых тем, составления конспекта.
    * Модуль: `app/telegram_handler.py` -> `app/text_analyzer.py`
9.  **Генерация документов (TODO):** На основе результатов анализа и метаданных формируются итоговые документы (DOCX, PDF и т.д.).
    * Модуль: `app/telegram_handler.py` -> `app/doc_generator.py`
10. **Отправка результатов (TODO):** Сгенерированные документы отправляются пользователю через Telegram.
    * Модуль: `app/telegram_handler.py`

## Установка и запуск

### Требования
* Python 3.9+
* Доступ к Google Cloud Platform
* Созданный Telegram Бот (@BotFather)

### Шаги установки
1.  **Клонировать репозиторий:**
    ```bash
    git clone <url-репозитория>
    cd MAI_bot
    ```
2.  **Создать и активировать виртуальное окружение:**
    ```bash
    python -m venv .venv
    # Windows
    # .venv\Scripts\activate
    # macOS/Linux
    source .venv/bin/activate
    ```
3.  **Установить зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Настроить Google Cloud:**
    * Создайте проект в Google Cloud Console (если еще нет).
    * Включите API: `Google Cloud Storage API` и `Google Cloud Speech-to-Text API`.
    * Создайте сервисный аккаунт (Service Account). Инструкция: [https://cloud.google.com/iam/docs/service-accounts-create](https://cloud.google.com/iam/docs/service-accounts-create)
    * Назначьте сервисному аккаунту необходимые роли:
        * `Storage Object Admin` (или `Storage Object Creator` + `Storage Object Viewer` на нужный бакет) - для работы с GCS.
        * `Speech Recognizer Client` (или более специфичная роль) - для работы с S2T.
    * Скачайте JSON-ключ для этого сервисного аккаунта.
    * Создайте бакет (Bucket) в Google Cloud Storage для хранения аудиофайлов.

5.  **Настроить конфигурацию бота:**
    * Создайте файл `.env` в корневой папке проекта (`MAI_bot/.env`).
    * Скопируйте в него содержимое из примера ниже, заменив значения на ваши:
        ```dotenv
        # .env
        TELEGRAM_BOT_TOKEN='ВАШ_ТОКЕН_ОТ_BOTFATHER'
        # Укажите ПОЛНЫЙ путь к скачанному JSON-ключу сервисного аккаунта
        GOOGLE_APPLICATION_CREDENTIALS='/полный/путь/к/вашему/ключа-sa.json'
        # Укажите имя вашего бакета в GCS
        GCS_BUCKET_NAME='имя-вашего-gcs-бакета'
        ```

### Запуск бота
```bash
python main.py
```
Бот начнет работать и будет выводить логи в консоль и в файл `logs/bot.log`.

## Запуск тестов (TODO)

Для запуска тестов (когда они будут написаны), используйте `pytest`:
```bash
pytest tests/
```

```
